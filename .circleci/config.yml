version: 2.1

executors:
  node-executor:
    docker:
      - image: circleci/node:16

jobs:
  build:
    executor: node-executor
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: npm install
      # - run:
      #     name: Run test
      #     command: npm test
      # - run:
      #     name: Build project
      #     command: npx update-browserslist-db@latest
      # - run:
      #     name: Build project
      #     command: npm run build
      
      - run:
         name: Run SonarQube Analysis
         command: |
           # Download SonarQube Scanner
           curl -o sonar-scanner-cli.zip -L https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.6.2.2472-linux.zip
           unzip sonar-scanner-cli.zip
           export PATH=$PATH:$(pwd)/sonar-scanner-4.6.2.2472-linux/bin
      
           # Run SonarQube Scanner
           sonar-scanner \
             -Dsonar.projectKey=my_node_project \
             -Dsonar.sources=src \
             -Dsonar.host.url=$SONAR_HOST_URL \
             -Dsonar.login=$SONAR_TOKEN
